<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>–°–¥–µ–ª–∫–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>


    <h2>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</h2>

  <script async src="https://telegram.org/js/telegram-widget.js?22"
    data-telegram-login="TON_smart_changer_bot" 
    data-size="large"
    data-userpic="true"
    data-request-access="write"
    data-userpic="true"
    data-on-auth="onTelegramAuth">
  </script>

  <script>
    function onTelegramAuth(user) {
      document.body.innerHTML += `
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.first_name}!</p>
        <p>–í–∞—à Telegram ID: ${user.id}</p>
        <p>–Æ–∑–µ—Ä–Ω–µ–π–º: @${user.username}</p>
        <img src="${user.photo_url}" width="100" />
        <pre>${JSON.stringify(user, null, 2)}</pre>
      `;
    }
  </script>


    <header id="username-header">–ó–∞–≥—Ä—É–∑–∫–∞...</header>

    <div class="container">

        <div class="column">
            <h3 id="receive_id" class="nick_name">–í—ã –æ—Ç–¥–∞—ë—Ç–µ</h3>
            <img src="/Users/macbook/Desktop/Papka/Durov.jpg" class="avatar">
            <div class="column_block" id="your-resources">
                <div class="values">
                    <label class="resource-item"><input type="checkbox" value="–ó–æ–ª–æ—Ç–æ"> –ó–æ–ª–æ—Ç–æ</label>
                    <label class="resource-item"><input type="checkbox" value="–°–µ—Ä–µ–±—Ä–æ"> –°–µ—Ä–µ–±—Ä–æ</label>
                    <label class="resource-item"><input type="checkbox" value="–ê–ª–º–∞–∑—ã"> –ê–ª–º–∞–∑—ã</label>
                </div>
                    <button class="add_value_btn" onclick="addNewResource('user-resources')">+</button>
            </div>
        </div>

        <div class="loader" id="loader"></div>

        <div class="column">
            <h3 id="give_id" class="nick_name">–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ</h3>
            <img src="Mark.jpg" class="avatar">
            <div class="column_block" id="user-resources">
                <div class="values">
                <label class="resource-item"><input type="checkbox" value="–ù–µ—Ñ—Ç—å"> –ù–µ—Ñ—Ç—å</label>
                <label class="resource-item"><input type="checkbox" value="–ü–ª–∞—Ç–∏–Ω–∞"> –ü–ª–∞—Ç–∏–Ω–∞</label>
                <label class="resource-item"><input type="checkbox" value="–£—Ä–∞–Ω"> –£—Ä–∞–Ω</label>
                </div>
                <button class="add_value_btn" onclick="addNewResource('user-resources')">+</button>
            </div>
        </div>
    </div>

    <div class="actions">
        <button class="confirm" onclick="confirmTrade()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–±–º–µ–Ω</button>
        <button class="cancel" onclick="cancelTrade()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
    </div>

    <div class="status" id="status"></div>

    <script>
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ username –∏–∑ URL
        const params = new URLSearchParams(window.location.search);
        const username = params.get('username');
        const header = document.getElementById('username-header');
        header.textContent = username ? `–û–±–º–µ–Ω —Å @${username}` : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω";
        const receive = document.getElementById("receive_id");
        receive.textContent = username ? `@${username} –ø–æ–ª—É—á–∏—Ç` : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω";
        const give = document.getElementById("give_id");
        give.textContent = username ? `@${username} –æ—Ç–¥–∞—ë—Ç` : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω";

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        function getSelected(containerId) {
            const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`);
            return Array.from(checkboxes).map(cb => cb.value);
        }



        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
        function addNewResource(containerId) {
            const container = document.getElementById(containerId);
            const valuesDiv = container.querySelector('.values');
            
            // –°–æ–∑–¥–∞–µ–º input –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'new-resource-input';
            input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞';
            
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            const confirmBtn = document.createElement('button');
            confirmBtn.textContent = '‚úì';
            confirmBtn.style.marginLeft = '5px';
            confirmBtn.style.backgroundColor = 'var(--success)';
            confirmBtn.style.color = 'white';
            confirmBtn.style.border = 'none';
            confirmBtn.style.borderRadius = '4px';
            confirmBtn.style.padding = '5px 10px';
            confirmBtn.style.cursor = 'pointer';
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–≤–æ–¥–∞
            const inputContainer = document.createElement('div');
            inputContainer.style.display = 'flex';
            inputContainer.style.alignItems = 'center';
            inputContainer.style.margin = '5px 0';
            inputContainer.appendChild(input);
            inputContainer.appendChild(confirmBtn);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π "+"
            const addButton = container.querySelector('.add_value_btn');
            container.insertBefore(inputContainer, addButton);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            confirmBtn.onclick = function() {
                const resourceName = input.value.trim();
                if (resourceName) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —á–µ–∫–±–æ–∫—Å
                    const newItem = document.createElement('label');
                    newItem.className = 'resource-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = resourceName;
                    
                    newItem.appendChild(checkbox);
                    newItem.appendChild(document.createTextNode(' ' + resourceName));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —á–µ–∫–±–æ–∫—Å –≤ —Å–ø–∏—Å–æ–∫
                    valuesDiv.appendChild(newItem);
                    
                    // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤–≤–æ–¥–∞
                    container.removeChild(inputContainer);
                }
            };
            
            // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è Enter
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    confirmBtn.click();
                }
            };
        }



        function confirmTrade() {
            const yours = getSelected('your-resources');
            const theirs = getSelected('user-resources');
            const status = document.getElementById('status');
            const loader = document.getElementById('loader');

            if (yours.length === 0 || theirs.length === 0) {
                status.textContent = "–û–±–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–æ–ª–∂–Ω—ã –≤—ã–±—Ä–∞—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç–∏!";
                status.style.color = "var(--error)";
                return;
            }

            loader.classList.add("spin");
            status.textContent = "";

            // –≠–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ–±–º–µ–Ω–∞
            setTimeout(() => {

                loader.classList.remove("spin");
                status.textContent = "–û–±–º–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω! –°–¥–µ–ª–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.";
                status.style.color = "var(--success)";

                // üîí –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            }, 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ 2 —Å–µ–∫—É–Ω–¥—ã
        }

        function cancelTrade() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            const status = document.getElementById('status');
            status.textContent = "–°–¥–µ–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –¶–µ–Ω–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã.";
            status.style.color = "var(--error)";
        }
    </script>
</body>

</html>